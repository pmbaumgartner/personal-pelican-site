<!DOCTYPE html>
<html lang="en">

<head>
      <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="Peter Baumgartner Personal website.">
    <meta name="author" content="Peter Baumgartner">
    <link rel="icon" href="../favicon.ico">

    <title>Creating Slack Slash Commands with Python and Flask: Part 1 - Blog</title>

    <!-- JQuery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script>
        window.jQuery || document.write('<script src="/theme/js/jquery.min.js"><\/script>')
    </script>

    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css" integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ"
        crossorigin="anonymous">
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <link rel="stylesheet" type="text/css" href="/theme/css/ie10-viewport-bug-workaround.css" />
    <!-- Custom styles for this template -->
    <link rel="stylesheet" type="text/css" href="/theme/css/style.css" />
    <link rel="stylesheet" type="text/css" href="/theme/css/notebooks.css" />
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,700" rel="stylesheet">
    <link rel='stylesheet' href='https://cdn.jsdelivr.net/font-hack/2.020/css/hack.min.css'>
    

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link href="/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Peter Baumgartner Full Atom Feed"
    />         <link href="/feeds/blog.atom.xml" type="application/atom+xml" rel="alternate"
        title="Peter Baumgartner Categories Atom Feed" />    

    <meta name="tags" content="python" />
    <meta name="tags" content="flask" />
    <meta name="tags" content="slack" />
    <meta name="tags" content="programming" />


</head>

<body>
    <nav class="navbar fixed-top navbar-toggleable-md navbar-inverse mb-5" style="background-color: #2b80a1;">
        <div class="container">
            <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarNavDropdown"
                aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>
            <a class="navbar-brand" href="">Peter Baumgartner</a>
            <div class="collapse navbar-collapse" id="navbarNavDropdown">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="#">Home</a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="http://example.com" id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            About
                        </a>
                        <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                            <a href="/pages/about.html" class="dropdown-item">About Peter</a>
                            <a href="https://github.com/pmbaumgartner" class="dropdown-item">GitHub</a>
                            <a href="https://twitter.com/crassvalidation" class="dropdown-item">Twitter</a>
                            <a href="https://www.linkedin.com/in/peterbaumgartner" class="dropdown-item">LinkedIn</a>
                        </div>
                    </li>
                </ul>
                <form class="form-inline ml-auto" action=".">
                    <div class="input-group">
                        <input type="text" class="form-control" placeholder="Search">
                        <span class="input-group-btn">
                            <button class="btn btn-outline-info" type="submit">Find</button>
                        </span>
                    </div>
                </form>
            </div>
        </div>
    </nav>

    <!-- end of header section -->
    <div class="container mt-5 pt-5">
<section id="content" class="body">
    <header>
    <h1>
      Creating Slack Slash Commands with Python and Flask: Part 1
    </h1>
</header>
<div class='article_content'>
<h2>Part 1: Setting Up Our Workflow and a Simple Application</h2>
<p>A few weekends ago my pet project was to set up a drive time slash command in Slack. Searching through our organization's Slack conversation history, on top of overhearing several conversations, it seems like traffic is both a source of anguish and a favorite topic for smalltalk in our office.</p>
<p>With that in mind, I set out to create a Slash Command for our Slack team. The end product was a slash command command that returned real time traffic and drive time data from the Google Directions API to Slack.</p>
<p>The process was a bit arduous, especially for a relative web development newbie. There’s quite a bit to understand for all the pieces to come together, so I thought I would document a the process to help out other Slackers looking to create custom Slack commands. In addition, I’ll walk through some of the debugging and problem solving I did while creating an app. We won't be replicating the <code>/drive</code> command, but be working with something more simple for the purposes of this example.</p>
<h3>Final Product for the Complete Tutorial</h3>
<p>When we're done with the complete tutorial we will have created a slash command for Slack that allows a user to get information on expected rainfall rain at a specified location. Our final command will be <code>/rain</code>, but we'll be making a simple <code>/hello</code> command for this part of the tutorial.</p>
<h3>Requirements</h3>
<p><strong>Software</strong></p>
<ul>
<li>Slack</li>
<li>Python 3.x (It will probably work on 2.x as well)</li>
<li>Flask</li>
<li>A text editor (I used Sublime Text 2, but am starting to love Atom)</li>
<li><a href="https://ngrok.com/">ngrok</a> for testing our application</li>
<li><a href="https://developer.forecast.io/">forecast.io</a> API Key</li>
</ul>
<p><strong>Skills</strong></p>
<ul>
<li>Basic command line familiarity</li>
<li>Basic python skills (package installation, basic syntax)</li>
</ul>
<p><strong>Other Notes</strong>: I built this on OSX, so some language or operations may be OS specific.</p>
<h2>Setting up a Workflow</h2>
<p>Let’s create a simple “Hello World” Flask app to understand the foundational structure of a Flask application. As we do so, we'll walk through the steps of a workflow that will allow us to test our application from within Slack.</p>
<h3>Creating a Flask App</h3>
<p>Create a new folder for your application and inside of it create a new python file -- <code>hello.py</code> will work. Insert the following code into that file:</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/hello&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">hello</span><span class="p">():</span>
    <span class="k">return</span> <span class="s1">&#39;Hello Slack!&#39;</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">port</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;PORT&#39;</span><span class="p">,</span> <span class="mi">5000</span><span class="p">))</span>
    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s1">&#39;0.0.0.0&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="n">port</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>


<p>This is actually our entire application. Let's take a look at one block at a time to understand the code.</p>
<h4>Importing Flask &amp; Creating an Application Object</h4>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</pre></div>


<p>In this step we're importing the required libraries. We're importing the <code>Flask</code> class from the <code>flask</code> package, as well as the <code>os</code> package, which we'll need later in our code.</p>
<p>We're also creating an application object named <code>app</code> from the <code>Flask</code> class. Don't worry about the <code>__name__</code> parameter for the Flask object, if you're really curious <a href="http://flask.pocoo.org/docs/0.10/api/">here's some detail</a>.</p>
<h4>Defining Routing and Request Methods</h4>
<div class="highlight"><pre><span></span><span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/hello&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">hello</span><span class="p">():</span>
    <span class="k">return</span> <span class="s1">&#39;Hello Slack!&#39;</span>
</pre></div>


<p>This is the functional meat of our application so let's break it down. <code>@app.route()</code> is a function decorator -- it basically modifies something about the next function we're going to declare. The first parameter to this decorator is <code>'/hello'</code>. This parameter is critically important: it defines what happens when someone goes to the URL <code>http://www.oururl.com/hello</code>. The second parameter is <code>methods=['POST']</code>. This is telling us that we are only going to accept POST requests at this route.</p>
<p>The idea of requests were a bit perplexing to me at first so I'll try and briefly explain. At the most basic level, communication on the internet mostly exists between clients and servers (there's actually a good Simple Wikipedia article on <a href="https://simple.wikipedia.org/wiki/Client-server">this</a>). For example: when you're surfing the web, you're actually making a <code>GET</code> request as a client to the server in order to view a webpage. This request tells a website or application to "give the client some information". For this current page that information is HTML and some other files that are then interpreted by your web browser and displayed. <code>POST</code> requests tell a site or application that it will be receiving information at that URL. That is: instead of a website or application sending something, the application will receive something. In our case, our application is going to receive the <code>POST</code> request from Slack, and that request will contain some information which our application can use.</p>
<p>Finally we define the <code>hello()</code> function, which defines what happens when someone uses our <code>/hello</code> route. In this case, all we're going to do is return a string to them that says <code>Hello Slack!</code> if a request is made.</p>
<h4>Declaring the Application Port</h4>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">port</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;PORT&#39;</span><span class="p">,</span> <span class="mi">5000</span><span class="p">))</span>
    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s1">&#39;0.0.0.0&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="n">port</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>


<p>This last chunk does something simple: when you run this program (and it's the <a href="http://stackoverflow.com/questions/419163/what-does-if-name-main-do">main program</a>), find the port of <code>5000</code>, and then finally serve the application locally using that port.</p>
<h3>Testing our Application with ngrok</h3>
<p>Our application should be ready to test. Open terminal and navigate to your project folder, and type <code>python hello.py</code> to start our program. Terminal should pop up some information about where the server is running and that the debugger is active. Now we have to test our application.</p>
<p>This was a step that actually stumped me for a while. Previously, I had built applications or websites that only accepted <code>GET</code> requests. In this case, we can test it locally by just running the python file we created and browsing to <code>http://localhost:5000/hello</code> and we can see our application. If we did that now with our application, we'll get a nice Method Not Allowed page since our application only accepts post requests.</p>
<p>We could send <code>POST</code> requests from our computer to our application locally using <code>curl</code>, but that's more work than just loading a page in a browser and, more importantly, we would have to put some effort into making sure our request was in the same format as it would come from Slack. Additionally, our request won't be coming from our local computer to our local server, it will be coming from wherever the Slack server is to our server. Because of that, we can't use <code>localhost</code> for testing with Slack, since <code>localhost</code> (relative to Slack, which is sending the request) is where the Slack server is, and it doesn't have our application files.</p>
<p>Luckily, there's a fantastic application called <a href="https://ngrok.com/">ngrok</a> that allows us to create a public URL to access a local server. We can use this to host our application locally, then point our Slack application to the public URL generated by ngrok. Using ngrok is fairly simple: download the file, open a shell to where you downloaded the file (or take this time to add it to your path), and type <code>ngrok http 5000</code> in the shell. You should now see something like this in your terminal:</p>
<div class="highlight"><pre><span></span>ngrok by @inconshreveable

Tunnel Status                 online
Version                       <span class="m">2</span>.0.19/2.0.19
Web Interface                 http://127.0.0.1:4040
Forwarding                    http://c654a618.ngrok.io -&gt; localhost:5000
Forwarding                    https://c654a618.ngrok.io -&gt; localhost:5000

Connections                   ttl     opn     rt1     rt5     p50     p90
                            <span class="m">0</span>       <span class="m">0</span>       <span class="m">0</span>.00    <span class="m">0</span>.00    <span class="m">0</span>.00    <span class="m">0</span>.00
</pre></div>


<p>If we were accepting <code>GET</code> requests in our app, we could now head to the URLs above and view our page. However, if we go there now, nothing will happen since we're only accepting <code>POST</code> requests.</p>
<h3>Adding our Slash Command to Slack</h3>
<p>To add a slash command integration to your Slack channel, head to https://slack.com/apps, then navigate to <em>Browse apps &gt; Custom Integrations &gt; Slash Commands</em> and click the <em>Add Configuration</em> button.</p>
<p>Our slash command for our example will start as <code>/hello</code>. Type that in and click <em>Add Slash Command Configuration</em>.</p>
<p>After then, we have some options to configure on our app. The <strong>URL</strong> field is critical here. We're going to paste the URL that <code>ngrok</code> gave us, being sure to append <code>/hello</code> at the end. That means our URL should be something similar to: <code>http://c654a618.ngrok.io/hello</code>. The integration settings should match below:</p>
<p><img alt="Displaying the Response" src="/assets/integrationsettings.png" /></p>
<h4>Testing</h4>
<p>Now we can save our integration, head to a Slack channel (I prefer DMs with slackbot), and type <code>/hello</code> into the chat. We should see a response of "Hello Slack!" immediately after.</p>
<blockquote>
<p><img alt="Displaying the Response" src="/assets/helloslack.png" /></p>
</blockquote>
<p>You should also notice the requests popping up in the <code>ngrok</code> Terminal window every time you issue the command.</p>
<h3>In Summary</h3>
<p>Using Python, Flask, and ngrok we developed and tested a simple Flask application that responds to the <code>/hello</code> command in Slack.</p>
<p>Some key ideas that took me a while to comprehend:</p>
<ul>
<li>URLs accept multiple kinds of requests: <code>GET</code> and <code>POST</code> are the most common</li>
<li><code>GET</code> says: "give me some information"</li>
<li><code>POST</code> says: "I'm giving you information"</li>
<li>We can't test complex <code>POST</code> requests easily using <code>localhost</code>. Fortunately, we can use <code>ngrok</code> to get a public URL for a server we're running locally and send it <code>POST</code> requests from Slack</li>
</ul>
<h3>Next Time</h3>
<p>In the next part (<em>Creating Slack Slash Commands with Python and Flask: Part 2: Electric Bugaloo</em>), we'll extend our app to use a weather API that returns some information about expected rainfall. We'll also work to better understand how Slack sends requests to our app and what information is contained in a <code>POST</code> request.</p>
</div>
    <aside>
    <div class="card">
        <h3>Find an error or bug? Have a suggestion?</h3>
        <p>Everything on this site is avaliable on GitHub. Head on over and <a href='https://github.com/chrisalbon/notes_on_data_science_machine_learning_and_artificial_intelligence/issues/new'>submit an issue.</a> You can also message me directly on <a href='https://twitter.com/chrisalbon'>Twitter</a>.</p>
    </div>
    </aside>
</section>

    </div>
    <!-- start of footer section -->
    <footer class="footer">
        <div class="container">
            <p class="text-muted">
                <center>This project contains 5 pages and is available on <a href="https://github.com/pmbaumgartner/pmbaumgartner.github.io">GitHub</a>.
                </center>
            </p>
        </div>
    </footer>

    <!-- This jQuery line finds any span that contains code highlighting classes and then selects the parent <pre> tag and adds a border.
         This is done as a workaround to visually distinguish the code inputs and outputs -->
    <script>
        $(".hll, .n, .c, .err, .k, .o, .cm, .cp, .c1, .cs, .gd, .ge, .gr, .gh, .gi, .go, .gp, .gs, .gu, .gt, .kc, .kd, .kn, .kp, .kr, .kt, .m, .s, .na, .nb, .nc, .no, .nd, .ni, .ne, .nf, .nl, .nn, .nt, .nv, .ow, .w, .mf, .mh, .mi, .mo, .sb, .sc, .sd, .s2, .se, .sh, .si, .sx, .sr, .s1, .ss, .bp, .vc, .vg, .vi, .il").parent("pre").css("border", "1px solid #DEDEDE");
        $("blockquote").addClass('blockquote')
    </script>

    <!-- Bootstrap core JavaScript
      ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://code.jquery.com/jquery-3.1.1.slim.min.js" integrity="sha384-A7FZj7v+d/sdmMqp/nOQwliLvUsJfDHW+k9Omg/a/EheAdgtzNs3hpfag6Ed950n"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js" integrity="sha384-DztdAPBWPRXSA/3eYEEUWrWCy7G5KFbe8fFjk5JAIxUYHKkDx6Qin1DkWx51bBrb"
        crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js" integrity="sha384-vBWWzlZJ8ea9aCX4pEW3rVHjgjt7zpkNpZk+02D9phzyeVkE+jo0ieGizqPLForn"
        crossorigin="anonymous"></script>

</body>

</html>